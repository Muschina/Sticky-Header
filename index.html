<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">

<title>Header Sticky</title>
  <style type="text/css">
    * {
      margin: 0;
      padding: 0;
      -webkit-box-sizing: border-box;
      -moz-box-sizing: border-box;
      box-sizing: border-box;
    }

   /* html {
      -ms-touch-action: none;
    }*/

    body {
    	overflow: hidden;
      height: 100vh;
    }
    .wrapper {
      position: absolute; 
      width: 100%;
      height: 100%;
      overflow: scroll;
    }
    .container {
      height: 2500px;
    }
    .bar-black {
    	width: 100%;
    	height: 50px;
    	background-color: #333333;
    }
    .placeholder {
    	height: 200px;
    	width: 100%;
    }
    .bar-grey {
    	width: 100%;
    	height: 50px;
    	background-color: #999999;
    }
    #sticky-header {
    	position: absolute;
      top: 0;
      left: 0;
      z-index: 1;	
    }
  </style>
</head>
<body>
  <header id="sticky-header"></header>
  <div id="wrapper" class="wrapper">
    <div class="container">
      <a href="https://github.com/ltebean/sticky-header">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"/>
      </a>
      <div class="placeholder"></div>
      <div class="bar-black" data-bar="firstBar"></div>
      <div class="placeholder"></div>
      <div class="bar-grey" data-bar="secondBar"></div>
    </div>
  </div>
  
  <script type="text/javascript">
  	! function(name, definition) {
  if (typeof module != 'undefined' && module.exports) module.exports = definition();
  else if (typeof define == 'function') define(definition);
  else this[name] = definition();
}('sticky', function() {

  return sticky;
});

  function sticky(options) {
    
    var wrapper= options.wrapper;
    var header = options.header || document.querySelector('#sticky-header');
    var headerTop = options.top || 0;
    var el = calculateBarsOptions(options.el);
    // var body = document.getElementsByTagName('body')[0];
    // console.log('scroll ' + header.scrollTop, 'clientY ' + header.getBoundingClientRect().top, 'body ' + body.getBoundingClientRect().top);

    wrapper.onscroll = function(event) {
      var wrapperScrollTop = getWrapperScroll().top;
      checkAndChangeHeader(wrapperScrollTop)
    }

    function checkAndChangeHeader(wrapperScrollTop) {
      if (wrapperScrollTop - header.getBoundingClientRect().top < el[0].top - headerTop) {
        if(header.classList.contains(el[0].consistsClass)) {
          header.classList.remove(el[0].consistsClass);
        }
      } else {
          el.forEach(function(item) {
            if(wrapperScrollTop - header.getBoundingClientRect().top > item.top - headerTop) {
              // console.log('scroll ' + header.scrollTop, 'clientY ' + header.getBoundingClientRect().top, 'top' + header.style.top, 'body ' + body.getBoundingClientRect().top);
              var headerWidth = getBarWidth();
              header.clientY = 0;
              header.classList.add(item.consistsClass);
              header.style.width = headerWidth;
              header.style.top =  - header.getBoundingClientRect().top + 'px';
              // console.log('scroll ' + header.scrollTop, 'clientY ' + header.getBoundingClientRect().top, 'top' + header.style.top, 'body ' + body.getBoundingClientRect().top);
            } else {
              if(header.classList.contains(item.consistsClass)) {
                header.classList.remove(item.consistsClass);
              }
            }
          });
      }
    }

  	function calculateBarsOptions (arr) {
  		var elems = Array.prototype.slice.call(arr)// we do array of collection 

  		var barsArray = elems.map(function(item) {
  			var rect = item.getBoundingClientRect();
  			var wrapperScroll = getWrapperScroll();

  			return {
  				elem: item,
  				consistsClass: item.className,
  				left: rect.left + wrapperScroll.left,
  	      		top: rect.top + wrapperScroll.top,
  	      		width: rect.width,
  	      		height: rect.height
  			};
  		});

  		return barsArray.sort(sortBarsTopPosition);
  	}

    function getWrapperScroll() {
      return {
        top:  wrapper.scrollTop || window.pageYOffset,
        left: wrapper.scrollLeft || window.pageXOffset 
      };
    }

    function sortBarsTopPosition (firstObj, secondObj) {
  	  return firstObj.top - secondObj.top;
    }

    function getBarWidth() {
      return el[0].elem.clientWidth + 'px';
    }
  }
  </script>
  <script type="text/javascript">
  
    var bars=document.querySelectorAll('[data-bar]');
    var header = document.querySelector('#sticky-header');
    var wrapper = document.querySelector('#wrapper');
    
    sticky({el: bars, header: header, wrapper: wrapper});
  </script>
</body>
</html>